# @package _global_

# Replicates the VSE++ paper experiment

defaults:
  - override /transforms: baseline
  - override /model: null
  - override /optimizer: null
  - override /scheduler: null
  - override /trainer: null

experiment_name: VSEpp_replication
seed: 0

data:
  kwargs:
    batch_size: 128
    num_positives:
      train: 'random'
      test: 'all'

model:
  name: VSE
  kwargs:
    embedding_size: 1024
  image_encoder:
    name: ResNet
    kwargs: 
      architecture_name: resnet34
      pretrained: True
  text_encoder:
    name: GRU
    kwargs:
      vocabulary_size: ???
      token_embedding_size: 300
      num_layers: 1
      bidirectional: False

loss:
  margin: 0.2
  hardest_fraction: 1.0

optimizer:
  name: Adam
  kwargs:
    lr: 1e-2
    betas: [0.9, 0.999]
    weight_decay: 0

scheduler:
  list:
    - name: LinearWarmup
      kwargs:
        num_warmup_steps: 5000
      pl_kwargs:
        interval: step
    - name: MultiStepLR
      kwargs:
        milestones: [75]
        gamma: 0.1
      pl_kwargs:
        interval: epoch

trainer:
  kwargs:
    max_epochs: 225
    gradient_clip_val: 2.0
  callbacks: 
    - name: Unfreezing
      kwargs:
        milestones:
          'image_encoder': 150
    - name: HardestFractionDecay
      kwargs:
        total_steps: 5000
